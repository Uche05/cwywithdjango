{% extends "base.html" %}
{% load static %}

{% block title %}Client Dashboard{% endblock %}

{% block content %}
<main>
    <div id="cleaning-welcome">
        <h2>Welcome, {{ user.user.first_name|default:user.user.username }} ğŸ‘‹</h2>
    </div>

    <div id="btn-section">
        <!-- Add New Availability Form -->
        <div id="cleaning-services-2">
            <div class="testimonial-container">
                <h5>Add New Availability</h5>
                <form method="POST" action="{% url 'add_availability' %}">
                    {% csrf_token %}
                    <label for="start_date">Start Date & Time</label>
                    <input type="datetime-local" name="start_date" id="start_date" required>

                    <label for="end_date">End Date & Time</label>
                    <input type="datetime-local" name="end_date" id="end_date" required>

                    <label for="status">Status</label>
                    <select name="status" id="status">
                        <option value="OPEN">Open</option>
                        <option value="CLOSED">Closed</option>
                    </select>

                    <button type="submit">Add Availability</button>
                </form>
            </div>
        </div>

        <!-- Existing Availabilities -->
        <div id="cleaning-services-2">
            <div class="testimonial-container">
                <h5>Your Availabilities</h5>
                {% if availabilities %}
                    <ul class="list-group">
                        {% for availability in availabilities %}
                            <li class="testimonial">
                                <strong>{{ availability.start_date|date:"M d, Y H:i" }} - {{ availability.end_date|date:"M d, Y H:i" }}</strong><br>
                                Status: {{ availability.status }}<br>

                                <!-- edit button triggers modal or redirect -->
                                <a href="{% url 'edit_availability' availability.id %}" id="btnLogin1">Edit</a>

                                <!-- Delete button -->
                                <form method="POST" action="{% url 'delete_availability' availability.id %}" style="display:inline;">
                                    {% csrf_token %}
                                    <button type="submit" id="btnLogin2" onclick="return confirm('Are you sure you want to delete this availability?');">Delete</button>
                                </form>
                            </li>
                        {% endfor %}
                    </ul>
                {% else %}
                    <p class="reviews-text">You haven't added any availabilities yet.</p>
                {% endif %}
            </div>
        </div>

        <!-- Logout -->
        <a href="{% url 'logout' %}" id="btnContact">Logout</a>
    </div>
</main>
{% endblock %}
